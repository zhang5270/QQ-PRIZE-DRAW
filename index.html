<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025å¹´åº¦æ¸¸æˆæŠ½å¥–ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.35);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .game-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .mode-indicator {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            margin-top: 10px;
            font-weight: 600;
        }
        
        .admin-mode {
            background: #ff416c;
        }
        
        .main-content {
            padding: 25px;
        }
        
        .panel {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            border: 1px solid #eee;
        }
        
        h2 {
            color: #6a11cb;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
        }
        
        h2 i {
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: #6a11cb;
            outline: none;
            box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(106, 17, 203, 0.3);
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #00b09b, #96c93d);
        }
        
        .btn-danger {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .participant-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        
        .participant-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: #f9f9f9;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }
        
        .participant-item:hover {
            background-color: #f0f0f0;
        }
        
        .participant-item:last-child {
            border-bottom: none;
        }
        
        .participant-name {
            font-weight: 600;
            color: #333;
        }
        
        .participant-time {
            font-size: 0.85rem;
            color: #888;
            margin-top: 3px;
        }
        
        .participant-actions button {
            margin-left: 5px;
        }
        
        .timer {
            font-size: 2.8rem;
            font-weight: bold;
            text-align: center;
            color: #6a11cb;
            margin: 25px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .prize-display {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 25px 0;
            border: 3px solid #6a11cb;
            color: white;
        }
        
        .prize-title {
            font-size: 2rem;
            color: #ffd700;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .prize-description {
            color: #e0e0e0;
            line-height: 1.7;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .game-examples {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .game-examples h4 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .game-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .game-tag {
            background: rgba(106, 17, 203, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .winners-list {
            margin-top: 25px;
        }
        
        .winner-item {
            padding: 18px;
            background: linear-gradient(to right, #ffd700, #ffed4e);
            border-radius: 12px;
            margin-bottom: 12px;
            text-align: center;
            font-weight: 700;
            color: #8b6b00;
            font-size: 1.3rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .join-section {
            text-align: center;
            margin-top: 30px;
        }
        
        .join-form {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .join-input-group {
            display: flex;
            margin-bottom: 20px;
        }
        
        .join-input {
            flex: 1;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
            font-size: 1.1rem;
        }
        
        .join-btn {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            font-size: 1.1rem;
        }
        
        .empty-message {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #6a11cb;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .admin-only {
            border-left: 4px solid #ff416c;
            background-color: #fff5f7;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #777;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }
        
        .admin-key-section {
            background: #fff5f7;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .admin-key-input {
            max-width: 300px;
            margin: 10px auto;
        }
        
        .sync-status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 0.85rem;
        }
        
        .sync-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .sync-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6a11cb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .timer {
                font-size: 2.2rem;
            }
            
            .prize-title {
                font-size: 1.6rem;
            }
            
            .join-input-group {
                flex-direction: column;
            }
            
            .join-input {
                border-radius: 8px;
                border: 2px solid #ddd;
                margin-bottom: 10px;
            }
            
            .join-btn {
                border-radius: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="game-icon">
                <i class="fas fa-gamepad"></i>
            </div>
            <h1>2025å¹´åº¦æ¸¸æˆæŠ½å¥–</h1>
            <p class="subtitle">äº‘ç«¯æ•°æ®åŒæ­¥ | å…¬å¹³é€æ˜ | å®æ—¶å‚ä¸</p>
            <div class="mode-indicator" id="modeIndicator">å‚ä¸è€…æ¨¡å¼</div>
        </header>
        
        <div class="main-content">
            <!-- å‚ä¸è€…è§†å›¾ -->
            <div class="tab-content active" id="participantView">
                <div class="panel">
                    <div class="prize-display">
                        <div class="prize-title" id="viewPrizeName">2025å¹´åº¦æ¸¸æˆæŠ½å¥–</div>
                        <div class="prize-description" id="viewPrizeDescription">
                            ä¸­å¥–åè¯·è”ç³»ä»™å­é¹¿é¢†å–æœ€é«˜ä»·å€¼160å…ƒçš„å•æœºæ¸¸æˆï¼
                        </div>
                        
                        <div class="game-examples">
                            <h4>ğŸ® å¯é€‰æ¸¸æˆç¤ºä¾‹ï¼š</h4>
                            <div class="game-list">
                                <span class="game-tag">å¤©å›½æ‹¯æ•‘2</span>
                                <span class="game-tag">åŒå½±å¥‡é•œ</span>
                                <span class="game-tag">33å·è¿œå¾é˜Ÿ</span>
                                <span class="game-tag">æ˜Ÿæµ·å¥‡èˆª</span>
                                <span class="game-tag">æ—¶å…‰æ—…è€…</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-box">
                            <div class="stat-value" id="viewParticipantCount">0</div>
                            <div class="stat-label">å·²å‚ä¸äººæ•°</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="viewWinnerCount">1</div>
                            <div class="stat-label">ä¸­å¥–åé¢</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="viewTimeLeft">1å°æ—¶</div>
                            <div class="stat-label">å¼€å¥–å€’è®¡æ—¶</div>
                        </div>
                    </div>
                    
                    <div class="timer" id="viewCountdownTimer">
                        01:00:00
                    </div>
                    
                    <div class="join-section">
                        <h2><i class="fas fa-user-plus"></i> å‚ä¸æŠ½å¥–</h2>
                        <p style="margin-bottom: 20px; color: #666;">è¾“å…¥æ‚¨çš„æ˜µç§°å‚ä¸æŠ½å¥–ï¼Œæ¯äººåªèƒ½å‚ä¸ä¸€æ¬¡</p>
                        
                        <div class="join-form">
                            <div class="join-input-group">
                                <input type="text" class="join-input" id="joinName" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°" maxlength="20">
                                <button class="btn join-btn" id="joinBtn">
                                    <i class="fas fa-check"></i> ç«‹å³å‚ä¸
                                </button>
                            </div>
                            <div id="joinStatus"></div>
                        </div>
                    </div>
                    
                    <div class="winners-list" id="viewWinnersList">
                        <!-- ä¸­å¥–è€…å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary btn-small" id="refreshDataBtn">
                        <i class="fas fa-sync-alt"></i> åˆ·æ–°æ•°æ®
                    </button>
                    <span id="lastUpdateTime" style="margin-left: 10px; font-size: 0.85rem; color: #666;"></span>
                </div>
            </div>
            
            <!-- ç®¡ç†å‘˜è§†å›¾ -->
            <div class="tab-content" id="adminView">
                <div class="panel admin-only">
                    <h2><i class="fas fa-cog"></i> æŠ½å¥–è®¾ç½®</h2>
                    
                    <div class="form-group">
                        <label for="adminPrizeName"><i class="fas fa-trophy"></i> å¥–å“åç§°</label>
                        <input type="text" id="adminPrizeName" value="2025å¹´åº¦æ¸¸æˆæŠ½å¥–">
                    </div>
                    
                    <div class="form-group">
                        <label for="adminPrizeDescription"><i class="fas fa-file-alt"></i> å¥–å“æè¿°</label>
                        <textarea id="adminPrizeDescription">ä¸­å¥–åè¯·è”ç³»ä»™å­é¹¿é¢†å–æœ€é«˜ä»·å€¼160å…ƒçš„å•æœºæ¸¸æˆï¼</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminWinnerCount"><i class="fas fa-users"></i> ä¸­å¥–äººæ•°</label>
                        <input type="number" id="adminWinnerCount" min="1" max="10" value="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="adminTimerHours"><i class="fas fa-clock"></i> å¼€å¥–å€’è®¡æ—¶ï¼ˆå°æ—¶ï¼‰</label>
                        <input type="number" id="adminTimerHours" min="0" max="240" step="0.1" value="1">
                        <small style="color: #666; display: block; margin-top: 5px;">è®¾ç½®ä¸º0è¡¨ç¤ºæ‰‹åŠ¨å¼€å¥–ï¼Œä¸ä¼šè‡ªåŠ¨å¼€å¥–</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="adminMaxParticipants"><i class="fas fa-user-friends"></i> æœ€å¤§å‚ä¸äººæ•°ï¼ˆ0è¡¨ç¤ºä¸é™ï¼‰</label>
                        <input type="number" id="adminMaxParticipants" min="0" max="1000" value="10">
                    </div>
                    
                    <div class="action-buttons" style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-block" id="saveAdminSettings">
                            <i class="fas fa-save"></i> ä¿å­˜è®¾ç½®
                        </button>
                    </div>
                </div>
                
                <div class="panel admin-only">
                    <h2><i class="fas fa-play-circle"></i> æŠ½å¥–æ§åˆ¶</h2>
                    
                    <div class="timer" id="adminCountdownTimer">
                        01:00:00
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 1.2rem; color: #6a11cb; margin-bottom: 10px;">
                            æŠ½å¥–çŠ¶æ€: <span id="drawStatusText">æœªå¼€å§‹</span>
                        </div>
                        <div style="color: #666;">
                            å‚ä¸è€…: <span id="adminParticipantCount">0</span> äºº | 
                            ä¸­å¥–åé¢: <span id="adminWinnerCountText">1</span> äºº
                        </div>
                    </div>
                    
                    <div class="action-buttons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn btn-secondary" id="startDrawBtn">
                            <i class="fas fa-play"></i> å¼€å§‹æŠ½å¥–
                        </button>
                        <button class="btn" id="drawNowBtn">
                            <i class="fas fa-bolt"></i> ç«‹å³å¼€å¥–
                        </button>
                        <button class="btn btn-danger" id="resetDrawBtn">
                            <i class="fas fa-redo"></i> é‡ç½®æŠ½å¥–
                        </button>
                    </div>
                </div>
                
                <div class="panel admin-only">
                    <h2><i class="fas fa-users"></i> å‚ä¸è€…ç®¡ç† <span id="adminParticipantCountText">(0äºº)</span></h2>
                    
                    <div class="participant-list" id="adminParticipantList">
                        <div class="empty-message">
                            æš‚æ— å‚ä¸è€…
                        </div>
                    </div>
                    
                    <div class="action-buttons" style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-danger" id="clearParticipantsBtn">
                            <i class="fas fa-trash"></i> æ¸…ç©ºå‚ä¸è€…
                        </button>
                        <button class="btn" id="exportParticipantsBtn">
                            <i class="fas fa-file-export"></i> å¯¼å‡ºåå•
                        </button>
                    </div>
                </div>
                
                <div class="panel admin-only">
                    <h2><i class="fas fa-trophy"></i> ä¸­å¥–ç»“æœ</h2>
                    
                    <div class="winners-list" id="adminWinnersList">
                        <div class="empty-message">
                            å°šæœªå¼€å¥–
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-block" id="announceWinnersBtn">
                            <i class="fas fa-bullhorn"></i> å…¬å¸ƒä¸­å¥–ç»“æœ
                        </button>
                        <small style="color: #666; display: block; margin-top: 10px;">å…¬å¸ƒåï¼Œå‚ä¸è€…å°†èƒ½çœ‹åˆ°ä¸­å¥–åå•</small>
                    </div>
                </div>
                
                <div class="panel admin-only">
                    <h2><i class="fas fa-tools"></i> äº‘ç«¯é…ç½®</h2>
                    
                    <div class="form-group">
                        <label for="gistIdInput"><i class="fab fa-github"></i> Gist ID</label>
                        <input type="text" id="gistIdInput" placeholder="è¯·è¾“å…¥Gist ID">
                        <small style="color: #666; display: block; margin-top: 5px;">ç”¨äºå­˜å‚¨æ•°æ®çš„GitHub Gist ID</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="githubTokenInput"><i class="fas fa-key"></i> GitHub Token</label>
                        <input type="password" id="githubTokenInput" placeholder="è¯·è¾“å…¥GitHub Token">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            éœ€è¦gistæƒé™çš„GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ<br>
                            <a href="https://github.com/settings/tokens" target="_blank" style="color: #6a11cb;">å¦‚ä½•åˆ›å»ºTokenï¼Ÿ</a>
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label for="syncIntervalInput"><i class="fas fa-sync-alt"></i> æ•°æ®åŒæ­¥é—´éš”ï¼ˆç§’ï¼‰</label>
                        <input type="number" id="syncIntervalInput" min="5" max="300" value="10">
                    </div>
                    
                    <div class="action-buttons" style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-block" id="saveConfigBtn">
                            <i class="fas fa-save"></i> ä¿å­˜é…ç½®
                        </button>
                        <button class="btn btn-block btn-secondary" id="testConnectionBtn">
                            <i class="fas fa-plug"></i> æµ‹è¯•è¿æ¥
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                        <h3><i class="fas fa-info-circle"></i> é…ç½®è¯´æ˜</h3>
                        <ol style="margin-left: 20px; margin-top: 10px; color: #666; font-size: 0.9rem;">
                            <li>åˆ›å»ºGitHubä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆéœ€è¦gistæƒé™ï¼‰</li>
                            <li>åˆ›å»ºGistå¹¶è·å–Gist ID</li>
                            <li>å¡«å…¥Gist IDå’ŒToken</li>
                            <li>ä¿å­˜é…ç½®ï¼Œç³»ç»Ÿå°†å¼€å§‹åŒæ­¥æ•°æ®</li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <!-- ç®¡ç†å‘˜å…¥å£ -->
            <div id="adminAccessSection" style="display: none;">
                <div class="admin-key-section">
                    <h3><i class="fas fa-lock"></i> ç®¡ç†å‘˜å…¥å£</h3>
                    <p>è¯·è¾“å…¥ç®¡ç†å‘˜å¯†é’¥ä»¥è¿›å…¥ç®¡ç†ç•Œé¢</p>
                    <input type="password" class="admin-key-input" id="adminKeyInput" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†é’¥">
                    <button class="btn" id="adminLoginBtn" style="margin-top: 10px;">
                        <i class="fas fa-sign-in-alt"></i> è¿›å…¥ç®¡ç†ç•Œé¢
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>2025å¹´åº¦æ¸¸æˆæŠ½å¥–ç³»ç»Ÿ &copy; 2025 | ä½¿ç”¨GitHub Gistäº‘ç«¯å­˜å‚¨ | æ•°æ®å®æ—¶åŒæ­¥</p>
            <p id="syncStatusText">æ­£åœ¨è¿æ¥äº‘ç«¯æ•°æ®...</p>
        </footer>
    </div>

    <script>
        // é…ç½®å¸¸é‡
        const DEFAULT_CONFIG = {
            gistId: "", // éœ€è¦æ‚¨å¡«å†™çš„Gist ID
            githubToken: "", // éœ€è¦æ‚¨å¡«å†™çš„GitHub Token
            syncInterval: 10, // æ•°æ®åŒæ­¥é—´éš”ï¼ˆç§’ï¼‰
            adminKey: "admin123", // ç®¡ç†å‘˜å¯†ç 
            lastSync: 0
        };
        
        // é»˜è®¤æ•°æ®
        const DEFAULT_DATA = {
            prizeName: "2025å¹´åº¦æ¸¸æˆæŠ½å¥–",
            prizeDescription: "ä¸­å¥–åè¯·è”ç³»ä»™å­é¹¿é¢†å–æœ€é«˜ä»·å€¼160å…ƒçš„å•æœºæ¸¸æˆï¼",
            winnerCount: 1, // é»˜è®¤1åä¸­å¥–è€…
            timerHours: 1,
            maxParticipants: 10, // é»˜è®¤æœ€å¤š10äººå‚ä¸
            drawStarted: false,
            drawTime: null,
            winners: [],
            winnersAnnounced: false,
            participants: [],
            lastUpdated: new Date().toISOString()
        };
        
        // æŠ½å¥–ç®¡ç†å™¨
        class GameLotteryManager {
            constructor() {
                this.config = {...DEFAULT_CONFIG};
                this.data = null;
                this.isAdmin = false;
                this.isLoading = false;
                this.syncInterval = null;
                this.countdownInterval = null;
                this.loadConfig();
            }
            
            // åŠ è½½é…ç½®
            loadConfig() {
                const savedConfig = localStorage.getItem('gameLotteryConfig');
                if (savedConfig) {
                    try {
                        this.config = {...this.config, ...JSON.parse(savedConfig)};
                    } catch (e) {
                        console.error('åŠ è½½é…ç½®å¤±è´¥', e);
                    }
                }
                
                // æ£€æŸ¥URLä¸­çš„ç®¡ç†å‘˜å‚æ•°
                this.checkAdminFromURL();
            }
            
            // ä¿å­˜é…ç½®
            saveConfig() {
                localStorage.setItem('gameLotteryConfig', JSON.stringify(this.config));
            }
            
            // æ£€æŸ¥URLä¸­çš„ç®¡ç†å‘˜å‚æ•°
            checkAdminFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const adminKey = urlParams.get('admin');
                
                if (adminKey && adminKey === this.config.adminKey) {
                    this.isAdmin = true;
                    this.showAdminView();
                } else {
                    this.showParticipantView();
                }
            }
            
            // æ˜¾ç¤ºç®¡ç†å‘˜è§†å›¾
            showAdminView() {
                document.getElementById('modeIndicator').textContent = 'ç®¡ç†å‘˜æ¨¡å¼';
                document.getElementById('modeIndicator').classList.add('admin-mode');
                document.getElementById('participantView').classList.remove('active');
                document.getElementById('adminView').classList.add('active');
                document.getElementById('adminAccessSection').style.display = 'none';
                
                // åˆå§‹åŒ–ç®¡ç†å‘˜é…ç½®
                document.getElementById('gistIdInput').value = this.config.gistId || '';
                document.getElementById('githubTokenInput').value = this.config.githubToken || '';
                document.getElementById('syncIntervalInput').value = this.config.syncInterval;
                
                // åŠ è½½æ•°æ®
                this.loadData();
            }
            
            // æ˜¾ç¤ºå‚ä¸è€…è§†å›¾
            showParticipantView() {
                document.getElementById('modeIndicator').textContent = 'å‚ä¸è€…æ¨¡å¼';
                document.getElementById('modeIndicator').classList.remove('admin-mode');
                document.getElementById('participantView').classList.add('active');
                document.getElementById('adminView').classList.remove('active');
                document.getElementById('adminAccessSection').style.display = 'block';
                
                // åŠ è½½æ•°æ®
                this.loadData();
            }
            
            // åŠ è½½æ•°æ®
            async loadData() {
                if (this.isLoading) return;
                
                this.isLoading = true;
                this.updateSyncStatus('æ­£åœ¨åŒæ­¥æ•°æ®...');
                
                try {
                    // æ£€æŸ¥æ˜¯å¦æœ‰é…ç½®
                    if (!this.config.gistId || !this.config.githubToken) {
                        if (this.isAdmin) {
                            this.showMessage('è¯·å…ˆé…ç½®Gist IDå’ŒGitHub Token', 'error');
                        }
                        this.updateSyncStatus('æœªé…ç½®äº‘ç«¯å­˜å‚¨', 'error');
                        this.isLoading = false;
                        return;
                    }
                    
                    // ä»GiståŠ è½½æ•°æ®
                    const response = await fetch(`https://api.github.com/gists/${this.config.gistId}`, {
                        headers: {
                            'Authorization': `token ${this.config.githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const gistData = await response.json();
                    const fileContent = gistData.files['lottery_data.json'].content;
                    this.data = JSON.parse(fileContent);
                    
                    // æ›´æ–°æœ€ååŒæ­¥æ—¶é—´
                    this.config.lastSync = Date.now();
                    this.saveConfig();
                    
                    // æ›´æ–°ç•Œé¢
                    this.updateUI();
                    this.updateSyncStatus('æ•°æ®åŒæ­¥æˆåŠŸ ' + new Date().toLocaleTimeString('zh-CN'), 'success');
                    
                    // å¼€å§‹è‡ªåŠ¨åŒæ­¥
                    this.startAutoSync();
                    
                } catch (error) {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                    this.updateSyncStatus('æ•°æ®åŒæ­¥å¤±è´¥: ' + error.message, 'error');
                    
                    // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ˜¾ç¤ºé”™è¯¯è¯¦æƒ…
                    if (this.isAdmin) {
                        this.showMessage(`æ•°æ®åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                    }
                } finally {
                    this.isLoading = false;
                }
            }
            
            // ä¿å­˜æ•°æ®åˆ°Gist
            async saveData() {
                if (!this.data || !this.config.gistId || !this.config.githubToken) {
                    return false;
                }
                
                try {
                    // æ›´æ–°æœ€åä¿®æ”¹æ—¶é—´
                    this.data.lastUpdated = new Date().toISOString();
                    
                    const response = await fetch(`https://api.github.com/gists/${this.config.gistId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${this.config.githubToken}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify({
                            description: "æ¸¸æˆæŠ½å¥–ç³»ç»Ÿæ•°æ® - æœ€åæ›´æ–°: " + new Date().toLocaleString('zh-CN'),
                            files: {
                                "lottery_data.json": {
                                    content: JSON.stringify(this.data, null, 2)
                                }
                            }
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    // æ›´æ–°æœ€ååŒæ­¥æ—¶é—´
                    this.config.lastSync = Date.now();
                    this.saveConfig();
                    
                    this.updateSyncStatus('æ•°æ®ä¿å­˜æˆåŠŸ ' + new Date().toLocaleTimeString('zh-CN'), 'success');
                    return true;
                } catch (error) {
                    console.error('ä¿å­˜æ•°æ®å¤±è´¥:', error);
                    this.updateSyncStatus('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                    return false;
                }
            }
            
            // å¼€å§‹è‡ªåŠ¨åŒæ­¥
            startAutoSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                }
                
                this.syncInterval = setInterval(() => {
                    this.loadData();
                }, this.config.syncInterval * 1000);
            }
            
            // æ›´æ–°ç•Œé¢
            updateUI() {
                if (!this.data) return;
                
                // æ›´æ–°å‚ä¸è€…è§†å›¾
                document.getElementById('viewPrizeName').textContent = this.data.prizeName;
                document.getElementById('viewPrizeDescription').textContent = this.data.prizeDescription;
                document.getElementById('viewParticipantCount').textContent = this.data.participants.length;
                document.getElementById('viewWinnerCount').textContent = this.data.winnerCount;
                
                // æ›´æ–°å€’è®¡æ—¶
                this.updateCountdown();
                
                // æ›´æ–°ä¸­å¥–è€…æ˜¾ç¤º
                this.updateWinnersDisplay();
                
                // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
                const lastUpdate = new Date(this.data.lastUpdated);
                document.getElementById('lastUpdateTime').textContent = 'æœ€åæ›´æ–°: ' + lastUpdate.toLocaleTimeString('zh-CN');
                
                // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ›´æ–°ç®¡ç†å‘˜è§†å›¾
                if (this.isAdmin) {
                    document.getElementById('adminPrizeName').value = this.data.prizeName;
                    document.getElementById('adminPrizeDescription').value = this.data.prizeDescription;
                    document.getElementById('adminWinnerCount').value = this.data.winnerCount;
                    document.getElementById('adminTimerHours').value = this.data.timerHours;
                    document.getElementById('adminMaxParticipants').value = this.data.maxParticipants;
                    
                    document.getElementById('adminParticipantCount').textContent = this.data.participants.length;
                    document.getElementById('adminParticipantCountText').textContent = `(${this.data.participants.length}äºº)`;
                    document.getElementById('adminWinnerCountText').textContent = this.data.winnerCount;
                    
                    document.getElementById('drawStatusText').textContent = this.data.drawStarted ? 'è¿›è¡Œä¸­' : 'æœªå¼€å§‹';
                    
                    this.updateAdminCountdown();
                    this.updateAdminParticipantList();
                    this.updateAdminWinnersList();
                }
            }
            
            // æ›´æ–°å€’è®¡æ—¶
            updateCountdown() {
                const timerElement = document.getElementById('viewCountdownTimer');
                const timeLeftElement = document.getElementById('viewTimeLeft');
                
                if (!this.data.drawStarted || !this.data.drawTime) {
                    timerElement.textContent = '00:00:00';
                    timeLeftElement.textContent = 'å¾…å¼€å§‹';
                    return;
                }
                
                const now = new Date().getTime();
                const drawTime = this.data.drawTime;
                const timeLeft = drawTime - now;
                
                if (timeLeft <= 0) {
                    timerElement.textContent = '00:00:00';
                    timeLeftElement.textContent = 'å·²å¼€å¥–';
                    
                    // è‡ªåŠ¨å¼€å¥–
                    if (!this.data.winners || this.data.winners.length === 0) {
                        this.performDraw();
                    }
                    
                    return;
                }
                
                // è®¡ç®—å‰©ä½™æ—¶é—´
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                // æ›´æ–°æ˜¾ç¤º
                timerElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                timeLeftElement.textContent = `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
                
                // å¦‚æœæŠ½å¥–å·²å¼€å§‹ï¼Œå¯åŠ¨å€’è®¡æ—¶
                if (this.data.drawStarted && this.data.drawTime && !this.countdownInterval) {
                    this.startCountdown();
                }
            }
            
            // æ›´æ–°ç®¡ç†å‘˜å€’è®¡æ—¶
            updateAdminCountdown() {
                const timerElement = document.getElementById('adminCountdownTimer');
                
                if (!this.data.drawStarted || !this.data.drawTime) {
                    timerElement.textContent = '00:00:00';
                    return;
                }
                
                const now = new Date().getTime();
                const drawTime = this.data.drawTime;
                const timeLeft = drawTime - now;
                
                if (timeLeft <= 0) {
                    timerElement.textContent = '00:00:00';
                    return;
                }
                
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                timerElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // å¼€å§‹å€’è®¡æ—¶
            startCountdown() {
                if (this.countdownInterval) {
                    clearInterval(this.countdownInterval);
                }
                
                this.countdownInterval = setInterval(() => {
                    this.updateCountdown();
                    this.updateAdminCountdown();
                    
                    if (this.data.drawStarted && this.data.drawTime) {
                        const now = new Date().getTime();
                        if (now >= this.data.drawTime) {
                            this.performDraw();
                            clearInterval(this.countdownInterval);
                        }
                    }
                }, 1000);
            }
            
            // æ·»åŠ å‚ä¸è€…
            async addParticipant(name) {
                // éªŒè¯è¾“å…¥
                if (!name || name.trim() === '') {
                    return {success: false, message: 'è¯·è¾“å…¥æ˜µç§°'};
                }
                
                name = name.trim();
                
                // æ£€æŸ¥æ˜¯å¦å·²å‚ä¸
                const participantId = this.generateParticipantId(name);
                const alreadyParticipated = this.data.participants.some(p => p.id === participantId);
                if (alreadyParticipated) {
                    return {success: false, message: 'æ‚¨å·²ç»å‚ä¸è¿‡æŠ½å¥–äº†'};
                }
                
                // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æœ€å¤§å‚ä¸äººæ•°
                if (this.data.maxParticipants > 0 && this.data.participants.length >= this.data.maxParticipants) {
                    return {success: false, message: 'å‚ä¸äººæ•°å·²è¾¾ä¸Šé™'};
                }
                
                // æ£€æŸ¥æŠ½å¥–æ˜¯å¦å·²å¼€å§‹
                if (this.data.drawStarted) {
                    return {success: false, message: 'æŠ½å¥–å·²å¼€å§‹ï¼Œæ— æ³•å‚ä¸'};
                }
                
                // æ·»åŠ å‚ä¸è€…
                const participant = {
                    id: participantId,
                    name: name,
                    time: new Date().toLocaleString('zh-CN')
                };
                
                this.data.participants.push(participant);
                
                // ä¿å­˜æ•°æ®
                const saved = await this.saveData();
                if (!saved) {
                    return {success: false, message: 'ä¿å­˜æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'};
                }
                
                // æ›´æ–°æ˜¾ç¤º
                this.updateUI();
                
                return {success: true, message: `æˆåŠŸå‚ä¸æŠ½å¥–ï¼æ‚¨æ˜¯ç¬¬${this.data.participants.length}ä½å‚ä¸è€…`};
            }
            
            // ç”Ÿæˆå‚ä¸è€…ID
            generateParticipantId(name) {
                // ä½¿ç”¨ç®€å•çš„æ–¹æ³•ç”ŸæˆIDï¼šåç§° + æ—¶é—´æˆ³ + éšæœºæ•°
                const timestamp = Date.now();
                const random = Math.floor(Math.random() * 10000);
                return `${name}_${timestamp}_${random}`;
            }
            
            // æ¸…ç©ºå‚ä¸è€…
            async clearParticipants() {
                if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å‚ä¸è€…å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                    return;
                }
                
                this.data.participants = [];
                
                // ä¿å­˜æ•°æ®
                const saved = await this.saveData();
                if (saved) {
                    this.showMessage('æ‰€æœ‰å‚ä¸è€…å·²æ¸…ç©º');
                    this.updateUI();
                } else {
                    this.showMessage('æ¸…ç©ºå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            }
            
            // ä¿å­˜ç®¡ç†å‘˜è®¾ç½®
            async saveAdminSettings() {
                // éªŒè¯è¾“å…¥
                const prizeName = document.getElementById('adminPrizeName').value.trim();
                const prizeDescription = document.getElementById('adminPrizeDescription').value.trim();
                const winnerCount = parseInt(document.getElementById('adminWinnerCount').value) || 1;
                const timerHours = parseFloat(document.getElementById('adminTimerHours').value) || 1;
                const maxParticipants = parseInt(document.getElementById('adminMaxParticipants').value) || 0;
                
                if (!prizeName) {
                    this.showMessage('è¯·è¾“å…¥å¥–å“åç§°', 'error');
                    return;
                }
                
                if (winnerCount < 1) {
                    this.showMessage('ä¸­å¥–äººæ•°å¿…é¡»è‡³å°‘ä¸º1', 'error');
                    return;
                }
                
                // æ›´æ–°æ•°æ®
                this.data.prizeName = prizeName;
                this.data.prizeDescription = prizeDescription;
                this.data.winnerCount = winnerCount;
                this.data.timerHours = timerHours;
                this.data.maxParticipants = maxParticipants;
                
                // ä¿å­˜æ•°æ®
                const saved = await this.saveData();
                if (saved) {
                    this.showMessage('è®¾ç½®å·²ä¿å­˜');
                    this.updateUI();
                }
            }
            
            // å¼€å§‹æŠ½å¥–
            async startDraw() {
                if (this.data.drawStarted) {
                    this.showMessage('æŠ½å¥–å·²å¼€å§‹', 'error');
                    return;
                }
                
                if (this.data.participants.length < this.data.winnerCount) {
                    this.showMessage(`å‚ä¸è€…ä¸è¶³ï¼å½“å‰${this.data.participants.length}äººï¼Œéœ€è¦${this.data.winnerCount}äºº`, 'error');
                    return;
                }
                
                // è®¾ç½®æŠ½å¥–å¼€å§‹æ—¶é—´
                this.data.drawStarted = true;
                this.data.drawTime = this.data.timerHours > 0 
                    ? new Date().getTime() + (this.data.timerHours * 60 * 60 * 1000)
                    : null;
                
                // æ¸…ç©ºä¸­å¥–è€…
                this.data.winners = [];
                this.data.winnersAnnounced = false;
                
                // ä¿å­˜æ•°æ®
                const saved = await this.saveData();
                if (saved) {
                    this.showMessage(`æŠ½å¥–å·²å¼€å§‹ï¼${this.data.timerHours > 0 ? `å°†åœ¨${this.data.timerHours}å°æ—¶åè‡ªåŠ¨å¼€å¥–` : 'è¯·æ‰‹åŠ¨å¼€å¥–'}`);
                    this.updateUI();
                }
            }
            
            // æ‰§è¡ŒæŠ½å¥–
            async performDraw() {
                if (this.data.winners && this.data.winners.length > 0) {
                    // å·²ç»æŠ½è¿‡å¥–äº†
                    this.updateWinnersDisplay();
                    this.updateAdminWinnersList();
                    return;
                }
                
                // æ£€æŸ¥å‚ä¸è€…æ•°é‡
                if (this.data.participants.length < this.data.winnerCount) {
                    this.showMessage(`å‚ä¸è€…ä¸è¶³ï¼Œæ— æ³•å¼€å¥–ï¼`, 'error');
                    return;
                }
                
                // éšæœºé€‰æ‹©ä¸­å¥–è€…
                const availableParticipants = [...this.data.participants];
                const winners = [];
                
                for (let i = 0; i < this.data.winnerCount; i++) {
                    if (availableParticipants.length === 0) break;
                    
                    const randomIndex = Math.floor(Math.random() * availableParticipants.length);
                    winners.push(availableParticipants[randomIndex]);
                    availableParticipants.splice(randomIndex, 1);
                }
                
                // æ›´æ–°æ•°æ®
                this.data.winners = winners;
                this.data.drawStarted = false;
                
                // ä¿å­˜æ•°æ®
                const saved = await this.saveData();
                if (saved) {
                    this.showMessage('æŠ½å¥–å®Œæˆï¼å·²äº§ç”Ÿä¸­å¥–è€…');
                    this.updateUI();
                }
            }
            
            // ç«‹å³å¼€å¥–
            async drawNow() {
                if (!this.data.drawStarted) {
                    this.showMessage('è¯·å…ˆå¼€å§‹æŠ½å¥–', 'error');
                    return;
                }
                
                if (!confirm('ç¡®å®šè¦ç«‹å³å¼€å¥–å—ï¼Ÿ')) {
                    return;
                }
                
                // æ‰§è¡ŒæŠ½å¥–
                await this.performDraw();
                
                // æ¸…é™¤å€’è®¡æ—¶
                if (this.countdownInterval) {
                    clearInterval(this.countdownInterval);
                    this.countdownInterval = null;
                }
            }
            
            // é‡ç½®æŠ½å¥–
            async resetDraw() {
                if (!confirm('ç¡®å®šè¦é‡ç½®æŠ½å¥–å—ï¼Ÿè¿™å°†æ¸…é™¤ä¸­å¥–ç»“æœå’ŒæŠ½å¥–çŠ¶æ€ã€‚')) {
                    return;
                }
                
                // é‡ç½®æŠ½å¥–çŠ¶æ€
                this.data.drawStarted = false;
                this.data.drawTime = null;
                this.data.winners = [];
                this.data.winnersAnnounced = false;
                
                // ä¿å­˜æ•°æ®
                const saved = await this.saveData();
                if (saved) {
                    this.showMessage('æŠ½å¥–å·²é‡ç½®');
                    
                    // æ¸…é™¤å€’è®¡æ—¶
                    if (this.countdownInterval) {
                        clearInterval(this.countdownInterval);
                        this.countdownInterval = null;
                    }
                    
                    this.updateUI();
                }
            }
            
            // æ›´æ–°ä¸­å¥–è€…æ˜¾ç¤ºï¼ˆå‚ä¸è€…è§†å›¾ï¼‰
            updateWinnersDisplay() {
                const winnersListElement = document.getElementById('viewWinnersList');
                
                if (!this.data.winnersAnnounced || !this.data.winners || this.data.winners.length === 0) {
                    winnersListElement.innerHTML = '';
                    return;
                }
                
                winnersListElement.innerHTML = '<h3 style="text-align: center; margin-bottom: 15px; color: #6a11cb;"><i class="fas fa-crown"></i> ä¸­å¥–åå•</h3>';
                
                this.data.winners.forEach((winner, index) => {
                    const winnerItem = document.createElement('div');
                    winnerItem.className = 'winner-item';
                    
                    let rankText = 'ğŸ† ä¸€ç­‰å¥–';
                    
                    winnerItem.innerHTML = `${rankText}: ${winner.name}`;
                    winnersListElement.appendChild(winnerItem);
                });
            }
            
            // æ›´æ–°å‚ä¸è€…åˆ—è¡¨ï¼ˆç®¡ç†å‘˜è§†å›¾ï¼‰
            updateAdminParticipantList() {
                const listElement = document.getElementById('adminParticipantList');
                
                if (this.data.participants.length === 0) {
                    listElement.innerHTML = '<div class="empty-message">æš‚æ— å‚ä¸è€…</div>';
                    return;
                }
                
                listElement.innerHTML = '';
                
                this.data.participants.forEach((participant, index) => {
                    const participantItem = document.createElement('div');
                    participantItem.className = 'participant-item';
                    participantItem.innerHTML = `
                        <div>
                            <div class="participant-name">${index + 1}. ${participant.name}</div>
                            <div class="participant-time">å‚ä¸æ—¶é—´: ${participant.time}</div>
                        </div>
                    `;
                    
                    listElement.appendChild(participantItem);
                });
            }
            
            // æ›´æ–°ä¸­å¥–è€…åˆ—è¡¨ï¼ˆç®¡ç†å‘˜è§†å›¾ï¼‰
            updateAdminWinnersList() {
                const winnersListElement = document.getElementById('adminWinnersList');
                
                if (!this.data.winners || this.data.winners.length === 0) {
                    winnersListElement.innerHTML = '<div class="empty-message">å°šæœªå¼€å¥–</div>';
                    return;
                }
                
                winnersListElement.innerHTML = '';
                
                this.data.winners.forEach((winner, index) => {
                    const winnerItem = document.createElement('div');
                    winnerItem.className = 'winner-item';
                    
                    let rankText = 'ğŸ† ä¸€ç­‰å¥–';
                    
                    winnerItem.innerHTML = `
                        <div>${rankText}: ${winner.name}</div>
                        <div style="font-size: 0.9rem; color: #8b6b00; margin-top: 5px;">å‚ä¸æ—¶é—´: ${winner.time}</div>
                    `;
                    winnersListElement.appendChild(winnerItem);
                });
            }
            
            // å…¬å¸ƒä¸­å¥–ç»“æœ
            async announceWinners() {
                if (!this.data.winners || this.data.winners.length === 0) {
                    this.showMessage('è¯·å…ˆå¼€å¥–', 'error');
                    return;
                }
                
                if (this.data.winnersAnnounced) {
                    this.showMessage('ä¸­å¥–ç»“æœå·²å…¬å¸ƒ', 'error');
                    return;
                }
                
                this.data.winnersAnnounced = true;
                
                // ä¿å­˜æ•°æ®
                const saved = await this.saveData();
                if (saved) {
                    this.showMessage('ä¸­å¥–ç»“æœå·²å…¬å¸ƒï¼å‚ä¸è€…ç°åœ¨å¯ä»¥çœ‹åˆ°ä¸­å¥–åå•');
                    this.updateWinnersDisplay();
                }
            }
            
            // å¯¼å‡ºå‚ä¸è€…åå•
            exportParticipants() {
                if (this.data.participants.length === 0) {
                    this.showMessage('æ²¡æœ‰å‚ä¸è€…å¯ä»¥å¯¼å‡º', 'error');
                    return;
                }
                
                const participantText = this.data.participants.map(p => `${p.name} (${p.time})`).join('\n');
                const dataBlob = new Blob([participantText], {type: 'text/plain'});
                
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `å‚ä¸è€…åå•_${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showMessage('å‚ä¸è€…åå•å·²å¯¼å‡º');
            }
            
            // ä¿å­˜äº‘ç«¯é…ç½®
            saveCloudConfig() {
                const gistId = document.getElementById('gistIdInput').value.trim();
                const githubToken = document.getElementById('githubTokenInput').value.trim();
                const syncInterval = parseInt(document.getElementById('syncIntervalInput').value) || 10;
                
                if (!gistId || !githubToken) {
                    this.showMessage('è¯·å¡«å†™Gist IDå’ŒGitHub Token', 'error');
                    return;
                }
                
                this.config.gistId = gistId;
                this.config.githubToken = githubToken;
                this.config.syncInterval = syncInterval;
                
                this.saveConfig();
                this.showMessage('é…ç½®å·²ä¿å­˜');
                
                // åŠ è½½æ•°æ®
                this.loadData();
            }
            
            // æµ‹è¯•è¿æ¥
            async testConnection() {
                const gistId = document.getElementById('gistIdInput').value.trim();
                const githubToken = document.getElementById('githubTokenInput').value.trim();
                
                if (!gistId || !githubToken) {
                    this.showMessage('è¯·å¡«å†™Gist IDå’ŒGitHub Token', 'error');
                    return;
                }
                
                try {
                    const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                        headers: {
                            'Authorization': `token ${githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    this.showMessage('è¿æ¥æµ‹è¯•æˆåŠŸï¼');
                } catch (error) {
                    this.showMessage(`è¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            // æ›´æ–°åŒæ­¥çŠ¶æ€
            updateSyncStatus(message, type = 'info') {
                const statusElement = document.getElementById('syncStatusText');
                statusElement.textContent = message;
                statusElement.className = '';
                
                if (type === 'success') {
                    statusElement.style.color = '#155724';
                    statusElement.style.fontWeight = '600';
                } else if (type === 'error') {
                    statusElement.style.color = '#721c24';
                    statusElement.style.fontWeight = '600';
                } else {
                    statusElement.style.color = '#666';
                }
            }
            
            // æ˜¾ç¤ºæ¶ˆæ¯
            showMessage(message, type = 'success') {
                // åˆ›å»ºæ¶ˆæ¯å…ƒç´ 
                const messageEl = document.createElement('div');
                messageEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'error' ? '#ff416c' : '#6a11cb'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    z-index: 1000;
                    font-weight: 600;
                    animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
                `;
                
                messageEl.textContent = message;
                document.body.appendChild(messageEl);
                
                // 3ç§’åç§»é™¤æ¶ˆæ¯
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.parentNode.removeChild(messageEl);
                    }
                }, 3000);
            }
        }

        // åˆå§‹åŒ–åº”ç”¨ç¨‹åº
        document.addEventListener('DOMContentLoaded', function() {
            // åˆ›å»ºæŠ½å¥–ç®¡ç†å™¨
            const lotteryManager = new GameLotteryManager();
            
            // å‚ä¸è€…åŠ å…¥äº‹ä»¶
            document.getElementById('joinBtn').addEventListener('click', async function() {
                const name = document.getElementById('joinName').value.trim();
                const result = await lotteryManager.addParticipant(name);
                
                const statusElement = document.getElementById('joinStatus');
                if (result.success) {
                    statusElement.innerHTML = `<div style="color: #00b09b; padding: 10px; background: #f0fff4; border-radius: 5px; margin-top: 10px;">
                        <i class="fas fa-check-circle"></i> ${result.message}
                    </div>`;
                    document.getElementById('joinName').value = '';
                } else {
                    statusElement.innerHTML = `<div style="color: #ff416c; padding: 10px; background: #fff5f7; border-radius: 5px; margin-top: 10px;">
                        <i class="fas fa-exclamation-circle"></i> ${result.message}
                    </div>`;
                }
            });
            
            // å›è½¦é”®å‚ä¸æŠ½å¥–
            document.getElementById('joinName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('joinBtn').click();
                }
            });
            
            // åˆ·æ–°æ•°æ®
            document.getElementById('refreshDataBtn').addEventListener('click', function() {
                lotteryManager.loadData();
            });
            
            // ç®¡ç†å‘˜ç™»å½•
            document.getElementById('adminLoginBtn').addEventListener('click', function() {
                const adminKey = document.getElementById('adminKeyInput').value;
                
                if (adminKey === lotteryManager.config.adminKey) {
                    // é‡å®šå‘åˆ°ç®¡ç†å‘˜æ¨¡å¼
                    const newUrl = window.location.origin + window.location.pathname + '?admin=' + adminKey;
                    window.location.href = newUrl;
                } else {
                    lotteryManager.showMessage('ç®¡ç†å‘˜å¯†é’¥é”™è¯¯', 'error');
                }
            });
            
            // ç®¡ç†å‘˜è®¾ç½®ä¿å­˜
            document.getElementById('saveAdminSettings').addEventListener('click', function() {
                lotteryManager.saveAdminSettings();
            });
            
            // å¼€å§‹æŠ½å¥–
            document.getElementById('startDrawBtn').addEventListener('click', function() {
                lotteryManager.startDraw();
            });
            
            // ç«‹å³å¼€å¥–
            document.getElementById('drawNowBtn').addEventListener('click', function() {
                lotteryManager.drawNow();
            });
            
            // é‡ç½®æŠ½å¥–
            document.getElementById('resetDrawBtn').addEventListener('click', function() {
                lotteryManager.resetDraw();
            });
            
            // æ¸…ç©ºå‚ä¸è€…
            document.getElementById('clearParticipantsBtn').addEventListener('click', function() {
                lotteryManager.clearParticipants();
            });
            
            // å¯¼å‡ºå‚ä¸è€…åå•
            document.getElementById('exportParticipantsBtn').addEventListener('click', function() {
                lotteryManager.exportParticipants();
            });
            
            // å…¬å¸ƒä¸­å¥–ç»“æœ
            document.getElementById('announceWinnersBtn').addEventListener('click', function() {
                lotteryManager.announceWinners();
            });
            
            // ä¿å­˜äº‘ç«¯é…ç½®
            document.getElementById('saveConfigBtn').addEventListener('click', function() {
                lotteryManager.saveCloudConfig();
            });
            
            // æµ‹è¯•è¿æ¥
            document.getElementById('testConnectionBtn').addEventListener('click', function() {
                lotteryManager.testConnection();
            });
            
            // æ·»åŠ CSSåŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
